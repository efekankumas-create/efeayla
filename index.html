<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>♠ Online Blackjack ♥</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#0b3d2e;color:#fff;text-align:center}
.panel{background:rgba(0,0,0,.45);margin:20px auto;padding:15px;border-radius:16px;max-width:420px}
input,button{padding:10px;margin:5px;border-radius:10px;border:none;font-size:15px}
button{background:#ffcc00;font-weight:bold;cursor:pointer}
.cards{display:flex;justify-content:center;gap:8px;min-height:60px}
.card{width:42px;height:62px;background:#fff;color:#000;border-radius:6px;display:flex;align-items:center;justify-content:center;animation:deal .3s ease}
@keyframes deal{from{transform:translateY(-15px);opacity:0}to{opacity:1}}
.hidden{display:none}
.turn{color:#ffcc00}
</style>
</head>

<body>
<h1>♠ Online Blackjack ♥</h1>

<div id="login" class="panel">
  <input id="room" placeholder="Oda Kodu (örn: efeayla)">
  <br>
  <button onclick="join()">Odaya Gir</button>
</div>

<div id="game" class="panel hidden">
  <h3 id="roomTitle"></h3>

  <h4 id="tEfe">Efe</h4>
  <div id="efeCards" class="cards"></div>
  <div id="efeScore"></div>

  <h4 id="tAyla">Ayla</h4>
  <div id="aylaCards" class="cards"></div>
  <div id="aylaScore"></div>

  <h4>Krupiye</h4>
  <div id="dealerCards" class="cards"></div>
  <div id="dealerScore"></div>

  <div>
    <button onclick="hit()">Hit</button>
    <button onclick="stand()">Stand</button>
    <button onclick="resetGame()">Yeni Oyun</button>
  </div>

  <h3 id="result"></h3>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyC_H3M5q_bFPPSi4Xw3_hpgPrbdTpcmEHo",
  authDomain:"blakja-a9592.firebaseapp.com",
  databaseURL:"https://blakja-a9592-default-rtdb.firebaseio.com",
  projectId:"blakja-a9592",
  storageBucket:"blakja-a9592.firebasestorage.app",
  messagingSenderId:"369055237282",
  appId:"1:369055237282:web:005a5b028efee55cd983fb"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let room="", me="";

function baseData(){
  return {
    turn:"efe",
    efe:[],
    ayla:[],
    dealer:[],
    done:{efe:false,ayla:false},
    result:""
  };
}

function join(){
  room=document.getElementById("room").value.trim();
  if(!room) return alert("Oda kodu yaz");
  me=prompt("İsmin? (efe / ayla)").toLowerCase();
  if(me!=="efe" && me!=="ayla") return alert("efe veya ayla yaz");

  document.getElementById("login").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  document.getElementById("roomTitle").innerText="Oda: "+room;

  const ref=db.ref("rooms/"+room);
  ref.once("value",s=>{ if(!s.exists()) ref.set(baseData()); });

  ref.on("value",s=>{
    const d=s.val() || baseData();
    draw("efeCards", d.efe);
    draw("aylaCards", d.ayla);
    draw("dealerCards", d.dealer);
    score("efeScore", d.efe);
    score("aylaScore", d.ayla);
    score("dealerScore", d.dealer);
    document.getElementById("tEfe").className=d.turn==="efe"?"turn":"";
    document.getElementById("tAyla").className=d.turn==="ayla"?"turn":"";
    document.getElementById("result").innerText=d.result || "";
  });
}

function card(){ return Math.floor(Math.random()*10)+1; }
function sum(a){ return (a||[]).reduce((x,y)=>x+y,0); }

function hit(){
  const ref=db.ref("rooms/"+room);
  ref.get().then(s=>{
    const d=s.val(); if(!d || d.turn!==me) return;
    d[me]=d[me]||[];
    d[me].push(card());
    if(sum(d[me])>21) d.done[me]=true;
    ref.set(d).then(nextTurn);
  });
}

function stand(){
  const ref=db.ref("rooms/"+room);
  ref.get().then(s=>{
    const d=s.val(); if(!d || d.turn!==me) return;
    d.done[me]=true;
    ref.set(d).then(nextTurn);
  });
}

function nextTurn(){
  const ref=db.ref("rooms/"+room);
  ref.get().then(s=>{
    const d=s.val();
    if(!d.done.efe){ d.turn="efe"; return ref.set(d); }
    if(!d.done.ayla){ d.turn="ayla"; return ref.set(d); }
    while(sum(d.dealer)<17) d.dealer.push(card());
    d.result=`Efe: ${sum(d.efe)} | Ayla: ${sum(d.ayla)} | Krupiye: ${sum(d.dealer)}`;
    ref.set(d);
  });
}

function resetGame(){
  if(me!=="efe") return alert("Yeni oyunu sadece Efe başlatır");
  db.ref("rooms/"+room).set(baseData());
}

function draw(id,arr){
  arr = arr || [];
  const el=document.getElementById(id);
  el.innerHTML="";
  arr.forEach(c=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerText=c;
    el.appendChild(d);
  });
}
function score(id,a){
  document.getElementById(id).innerText="Toplam: "+sum(a||[]);
}
</script>
</body>
</html>
